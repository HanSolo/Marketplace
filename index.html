<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Adoptium Marketplace</title>
  <link rel="stylesheet" type="text/css" href="./css/styles.css" media="screen"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
</head>
<body>

  <nav>      
      <a href="https://adoptium.net/index.html" class="a-button">
        <img src="./img/Logo_Adoptium_2021_03_08_JRR_RGB-V2G.png" height="120" style="object-position: 20px -10px" alt="Adoptium Logo">
      </a>
      <div id="header-social-bar">
        <div class="nav-item"><a class="light-link no-underline" href="">News</a></div>
        <div class="nav-separator">|</div>
        <div class="nav-item"><a class="light-link no-underline" href="https://blog.adoptium.net/">Blog</a></div>
        <div class="nav-separator">|</div>
        <div class="nav-item"><a class="light-link no-underline" href="https://adoptium.net">Temurin</a></div>
        <div class="nav-separator">|</div>
        <div class="nav-item"><a class="light-link no-underline" href="">Marketplace</a></div>
        <div class="nav-separator">|</div>

        <div class="social-icon align-center inline-block">
          <a href="https://twitter.com/adoptium" target="_blank" class="light-link no-underline">
            <span class="fa-stack fa-lg" style="font-size:1.10em;">
              <i class="fa fa-twitter fa-stack-1x fa-social-icon"></i>
            </span>
          </a>
        </div>
        <div class="social-icon align-center inline-block">
          <a href="https://www.youtube.com/c/EclipseAdoptium" target="_blank" class="light-link no-underline">
            <span class="fa-stack fa-lg" style="font-size:1.10em;">
              <i class="fa fa-youtube-play fa-stack-1x fa-social-icon"></i>
            </span>
          </a>
        </div>
        <div class="social-icon align-center inline-block">
          <a href="https://github.com/adoptium" target="_blank" class="light-link no-underline">
            <span class="fa-stack fa-lg" style="font-size:1.10em;">
              <i class="fa fa-github fa-stack-1x fa-social-icon"></i>
            </span>
          </a>
        </div>
        <div class="social-icon align-center inline-block">
          <a href="https://adoptium.net/slack.html" target="_blank" class="light-link no-underline">
            <span class="fa-stack fa-lg" style="font-size:1.10em;">
              <i class="fa fa-slack fa-stack-1x fa-social-icon"></i>
            </span>
          </a>
        </div>
      </div>
  </nav>
  
  <div class="alert align-center">
    <span class="closebtn" onclick="this.parentElement.style.display='none';">×</span>
    <strong>3rd December 2021</strong> Adoptium Marketplace now available on this site.<br>
    Need more info? See our post on
    <a style="color: white" href="https://blog.adoptium.net/2021/10/jlink-to-produce-own-runtime">
      the new Adoptium marketplace
    </a>
  </div>
  
  <main class="grey-bg home-main">
    <h1>Adoptium Marketplace</h1>
    <p class="intro">
    Java™ is the world's leading programming language and platform.
    The Adoptium Marketplace offers high-quality, TCK certified runtimes and associated technology for use across the Java™ ecosystem.<br>
    </p>
    
    <div>
      <div style="display:inline-block; vertical-align:top;">
      <img src="./img/Logo_AQAvit_2021_09_23_JRR_RGB-V1A.png" height="200" style="object-position: 20px 0px">
    </div>
      <div style="display:inline-block;">
      <p class="intro" style="padding-top:25px; margin-left: 0px; text-align:left;">
      The AQAvit test framework (<strong>A</strong>doptium <strong>Q</strong>uality <strong>A</strong>ssurance) can be found <a href="https://github.com/Adoptium/aqa-tests">here</a>.
      There is also a <a href="https://blog.adoptopenjdk.net/2017/12/testing-java-help-count-ways/">blog post and brief presentation</a> that explains what testing we run and how it fits into the overall delivery pipeline.
      </p>
    </div>
    </div>

    <ul>
      <li><input type="checkbox" id="vendor-adoptium" checked onchange="filter()"/>
        <label for="vendor-adoptium" title="Adoptium"><img src="./img/vendor_adoptium.png"/></label>
      </li>
      <li><input type="checkbox" id="vendor-microsoft" checked onchange="filter()"/>
        <label for="vendor-microsoft" title="Microsoft"><img src="./img/vendor_microsoft.png"/></label>
      </li>
      <li><input type="checkbox" id="vendor-azul" checked onchange="filter()"/>
        <label for="vendor-azul" title="Azul"><img src="./img/vendor_azul.png"/></label>
      </li>      
    </ul>

    <div class="filter-divs">
      <div class="filter-os filter-div">
        <span><strong>Operating System:</strong></span>
        <select id="os-filter" class="filter" onchange="filter()"><option value="any">Any</option><option value="linux">Linux</option><option value="alpine">Alpine</option><option value="windows">Windows</option><option value="macos">MacOS</option></select>
      </div>

      <div class="filter-arch filter-div">
        <span><strong>Architecture:</strong></span>
        <select id="arch-filter" class="filter" onchange="filter()"><option value="any">Any</option><option value="x86">x86</option><option value="x64">x64</option><option value="aarch64">aarch64</option></select>
      </div>
      
      <div class="filter-package-type filter-div">
        <span><strong>Package Type:</strong></span>
        <select id="package-type-filter" class="filter" onchange="filter()"><option value="any">Any</option><option value="jdk">JDK</option><option value="jre">JRE</option></select>
      </div>
      
      <div class="filter-archive-type filter-div">
        <span><strong>Archive Type:</strong></span>
        <select id="archive-type-filter" class="filter" onchange="filter()"><option value="any">Any</option><option value="tar.gz">tar.gz</option><option value="deb">deb</option><option value="rpm">rpm</option><option value="zip">zip</option><option value="msi">msi</option><option value="pkg">pkg</option><option value="dmg">dmg</option></select>
      </div>
      
      <div class="filter-version filter-div">
        <span><strong>Version:</strong></span>
        <select id="version-filter" class="filter" onchange="filter()"><option value="any">Any</option><option value="8">8</option><option value="11">11</option><option value="16">16</option><option value="17">17</option></select>
      </div>
    </div>
         
    <table id="download-table" class="main-download__variant__table releases-table">
       <thead>
         <tr class="table-head">
          <td class="table-head">Build Version</td><td class="table-head">Distribution</td><td class="table-head">Vendor</td><td class="table-head">Operating System</td><td class="table-head">Architecture</td><td class="table-head">Download</td>
         </tr>
       </thead>
       <tbody>
       </tbody>
    </table>
    
  </main>
  
  <footer id="solstice-footer">
    <div class="footer-container">
		<div class="footer-row">
			<section class="col-sm-6 hidden-print" id="footer-eclipse-foundation">
				<h2 class="section-title">Eclipse Foundation</h2>
				<ul class="nav">
					<li><a href="https://www.eclipse.org/org/">About Us</a></li>
					<li><a href="https://www.eclipse.org/org/foundation/contact.php">Contact Us</a></li>
					<li><a href="https://www.eclipse.org/donate">Donate</a></li>
					<li><a href="https://www.eclipse.org/membership">Members</a></li>
					<li><a href="https://www.eclipse.org/org/documents/">Governance</a></li>
					<li><a href="https://www.eclipse.org/org/documents/Community_Code_of_Conduct.php">Code of Conduct</a></li>
					<li><a href="https://www.eclipse.org/artwork/">Logo and Artwork</a></li>
					<li><a href="https://www.eclipse.org/org/foundation/directors.php">Board of Directors</a></li>
				</ul>
			</section>
			<section class="col-sm-6 hidden-print" id="footer-legal">
				<h2 class="section-title">Legal</h2>
				<ul class="nav">
					<li><a href="https://www.eclipse.org/legal/privacy.php">Privacy Policy</a></li>
					<li><a href="https://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li>
					<li><a href="https://www.eclipse.org/legal/copyright.php">Copyright Agent</a></li>
					<li><a href="https://www.eclipse.org/legal/epl-2.0/">Eclipse Public License</a></li>
					<li><a href="https://www.eclipse.org/legal/">Legal Resources</a></li>
				</ul>
			</section>
			<section class="col-sm-6 hidden-print" id="footer-useful-links">
				<h2 class="section-title">Useful Links</h2>
				<ul class="nav">
					<li><a href="https://bugs.eclipse.org/bugs/">Report a Bug</a></li>
					<li><a href="//help.eclipse.org/">Documentation</a></li>
					<li><a href="https://www.eclipse.org/contribute/">How to Contribute</a></li>
					<li><a href="https://www.eclipse.org/mail/">Mailing Lists</a></li>
					<li><a href="https://www.eclipse.org/forums/">Forums</a></li>
					<li><a href="//marketplace.eclipse.org">Marketplace</a></li>
				</ul>
			</section>
			<section class="col-sm-6 hidden-print" id="footer-other">
				<h2 class="section-title">Other</h2>
				<ul class="nav">
					<li><a href="https://www.eclipse.org/ide/">IDE and Tools</a></li>
					<li><a href="https://www.eclipse.org/projects">Projects</a></li>
					<li><a href="https://www.eclipse.org/org/workinggroups/">Working Groups</a></li>
					<li><a href="https://www.eclipse.org/org/research/">Research@Eclipse</a></li>
					<li><a href="https://www.eclipse.org/security/">Report a Vulnerability</a></li>
					<li><a href="https://status.eclipse.org">Service Status</a></li>
				</ul>
			</section>
      </div>
			<div class="col-sm-24 margin-top-20">
				<div class="footer-row">
					<div id="copyright" class="col-md-16">
						<p id="copyright-text">Copyright © Eclipse Foundation, Inc. All Rights Reserved.</p>
            <p>Java and OpenJDK are trademarks or registered trademarks of Oracle and/or its affiliates. Other names may be trademarks of their respective owners.</p>
					</div>
				</div>
	    </div>
    </div>
  </footer>

  <script>
    const baseUrl       = 'https://api.foojay.io';
    const distributions = [ 'microsoft', 'temurin', 'zulu' ];
    const versions      = [ 17, 16, 11, 8 ];
    let   pkgs          = [];
    let   selectedPkgs  = [];
    

    init();
        
    
    
    function init() {
      // Collect all available packages defined by distributions and versions and store them in pkgs
      collectAllPkgs();
    
      let operatingSystem = getOperatingSystem();
      switch(operatingSystem) {
        case 'Windows': 
          document.getElementById('os-filter').value = 'windows'; 
          document.getElementByid('archive-type-filter').value = 'msi';
          break;
        case 'Linux': 
        case 'Unix' : 
          document.getElementById('os-filter').value = 'linux'; 
          document.getElementById('archive-type-filter').value = 'tar.gz';
          break;
        case 'MacOS': 
          document.getElementById('os-filter').value = 'macos';
          document.getElementById('archive-type-filter').value = 'tar.gz';
          break;
      }
    
      document.getElementById('arch-filter').value         = 'x64';
      document.getElementById('package-type-filter').value = 'jdk';
      document.getElementById('version-filter').value      = '17';
    }
    
    
    // Filter pkgs array for current selection and store it in selectedPkgs  
    function filter() {
      let microsoftSelected       = document.getElementById('vendor-microsoft').checked;
      let temurinSelected         = document.getElementById('vendor-adoptium').checked;
      let zuluSelected            = document.getElementById('vendor-azul').checked;
      let selectedOperatingSystem = document.getElementById('os-filter').value;
      let selectedArchitecture    = document.getElementById('arch-filter').value;
      let selectedPackageType     = document.getElementById('package-type-filter').value;
      let selectedArchiveType     = document.getElementById('archive-type-filter').value;
      let selectedVersion         = document.getElementById('version-filter').value;

      let libc;
      switch(selectedOperatingSystem) {
        case 'windows': libc = 'c_std_lib'; break;
        case 'linux'  : libc = 'glibc'; break;
        case 'macos'  : libc = 'libc'; break;
        case 'alpine' : libc = 'musl'; selectedOperatingSystem = 'linux'; break;
        default       : libc = ''; break;
      }
                  
      selectedPkgs = pkgs.filter(pkg => {
        let os;
        let lc;
        if (selectedOperatingSystem === 'any') {
          os = true;
          lc = true
        } else {
          os = pkg.operating_system == selectedOperatingSystem;
          lc = pkg.lib_c_type == libc;
        }
        
        let arc;
        if (selectedArchitecture === 'any') {
          arc = true;
        } else {
          arc = pkg.architecture == selectedArchitecture;
        }
        
        let pt;
        if (selectedPackageType === 'any') {
          pt = true;
        } else {
          pt = pkg.package_type == selectedPackageType;
        }
        
        let at;
        if (selectedArchiveType === 'any') {
          at = true;
        } else {
          at = pkg.archive_type == selectedArchiveType;
        }
        
        let ver;
        if (selectedVersion === 'any') {
          ver = true;
        } else {
          ver = pkg.major_version == selectedVersion;
        }
        
        let temurin   = temurinSelected   ? pkg.distribution == 'temurin'   : false;
        let microsoft = microsoftSelected ? pkg.distribution == 'microsoft' : false;
        let zulu      = zuluSelected      ? pkg.distribution == 'zulu'      : false;
        
        return os && lc && arc && pt && at && ver && (temurin || microsoft || zulu);
      });
            
      updateDownloads();
    }
    
    function updateDownloads() {
      // Clear table
      let downloadTableBody = document.getElementById('download-table').getElementsByTagName('tbody')[0];
      
      while (downloadTableBody.firstChild) {
        downloadTableBody.removeChild(downloadTableBody.lastChild);
      }
      
      selectedPkgs.forEach((pkg) => {
        var row = downloadTableBody.insertRow();
        
        // Version and Distribution
        var cellName       = row.insertCell();
        cellName.className = 'main-download__variant__name blue-bg';
        var versionText = document.createTextNode(normalizeJavaVersion(pkg.java_version));
        var spanVersion = document.createElement('span');
        spanVersion.appendChild(versionText);
        var packageTypeText = document.createTextNode(pkg.package_type == 'jdk' ? 'JDK' : 'JRE');
        var spanPackageType = document.createElement('span');
        spanPackageType.className='download-last-version';
        spanPackageType.appendChild(packageTypeText);
        cellName.appendChild(spanVersion);
        cellName.appendChild(spanPackageType);
        
        
        // Distribution
        var cellDistribution       = row.insertCell();
        cellDistribution.className = 'main-download__variant__distribution';
        var distributionText = document.createTextNode(capitalize(pkg.distribution) + (pkg.javafx_bundled ? ' (FX)' : ''));
        var spanDistribution = document.createElement('span');
        spanDistribution.appendChild(distributionText);
        cellDistribution.appendChild(spanDistribution);

                
        // Vendor
        var cellVendor       = row.insertCell();
        cellVendor.className = 'main-download__variant__vendor';
        var vendorImg = document.createElement('img');
        vendorImg.src = getImageForVendor(getVendorForDistribution(pkg.distribution));
        vendorImg.width = 100;
        var spanVendor = document.createElement('span');
        spanVendor.appendChild(vendorImg);
        cellVendor.appendChild(spanVendor);
        
        
        // Operating System
        let os = pkg.lib_c_type == 'musl' ? 'Alpine' : pkg.operating_system == 'macos' ? 'MacOS' : capitalize(pkg.operating_system);
        var cellOperatingSystem       = row.insertCell();
        cellOperatingSystem.className = 'main-download__variant__os';
        var operatingSystemText = document.createTextNode(os);
        var spanOperatingSystem = document.createElement('span');
        spanOperatingSystem.appendChild(operatingSystemText);
        cellOperatingSystem.appendChild(spanOperatingSystem);
        
        
        // Architecture
        var cellArchitecture       = row.insertCell();
        cellArchitecture.className = 'main-download__variant__architecture';
        var architectureText = document.createTextNode(pkg.architecture);
        var spanArchitecture = document.createElement('span');
        spanArchitecture.appendChild(architectureText);
        cellArchitecture.appendChild(spanArchitecture);
        
        
        // Archive Type
        var cellArchiveType       = row.insertCell();
        cellArchiveType.className = 'main-download__variant__archive-type';
        cellArchiveType.style.paddingLeft = '50px';
        var archiveTypeText = document.createTextNode('\u00A0' + pkg.archive_type);
        var archiveTypeIcon = document.createElement('i');
        archiveTypeIcon.className = 'fa fa-download';
        archiveTypeIcon.ariaHidden = true;
        var aArchiveType = document.createElement('a');
        aArchiveType.className = 'main-download__variant__sub-table__download';
        aArchiveType.appendChild(archiveTypeIcon);
        aArchiveType.appendChild(archiveTypeText);
        cellArchiveType.appendChild(aArchiveType);
              
        aArchiveType.onclick = async function() {             
          let promise = getDownloadLink(pkg.id, pkg.directly_downloadable);
          promise.then(function(uri) {
            let pkgUri = uri;
            if (pkgUri == null || pkgUri === undefined) { return; }
            window.open(pkgUri);
          }, function() { 
            console.log("Error: Problem getting download link");
            pkgUri = null;
          });
        }
      });
    }
    
    
    // Utility methods
    function normalizeJavaVersion(javaVersion) {
      let version = javaVersion
      if (version.indexOf('+') > -1) {
        version = version.substring(0, version.indexOf('+'));
        if (version.indexOf('-ea') > -1) {
          version = version.substring(0, version.indexOf('-ea'));
        }
      } else if (version.indexOf('-ea') > -1) {
        version = version.substring(0, version.indexOf('-ea'));
      }      
      return version;
    }
    
    function capitalize(text) {
      return text[0].toUpperCase() + text.slice(1);
    }
    
    function getVendorForDistribution(distribution) {
      switch(distribution) {
        case 'microsoft': return 'Microsoft';
        case 'temurin'  : return 'Eclipse Foundation';
        case 'zulu'     : return 'Azul';
        default         : return '';
      }
    }
    
    function getImageForVendor(vendor) {
      switch(vendor) {
        case 'Microsoft': return './img/microsoft_logo.png';
        case 'Eclipse Foundation': return './img/adoptium_logo.png';
        case 'Azul'              : return './img/azul_logo.png';
        default                  : return '';
      }
    }
    
    function getOperatingSystem() {
      if (navigator.appVersion.indexOf("Win") != -1)   return "Windows";
      if (navigator.appVersion.indexOf("Mac") != -1)   return "MacOS";
      if (navigator.appVersion.indexOf("Linux") != -1) return "Linux";
      if (navigator.appVersion.indexOf("X11") != -1)   return "Unix";
      return "unknown";
    }
        
    
    // Functions to collect packages using the foojay.io DiscoAPI
    function collectAllPkgs() {
      let promises = [];
      versions.forEach((version) => { promises.push(getAllPkgsForVersion(version).then((pkgsFound) => pkgsFound.forEach((pkg) => { pkgs.push(pkg); }))); });
      Promise.all(promises).then(res => filter());
    }
    
    async function getAllPkgsForVersion(version) {
      let params  = '?version=' + version;
      distributions.forEach((distro) => {
        params += ('&distro=' + distro);
      });
      params += '&release_status=ga&latest=available&operating_system=windows&operating_system=linux&operating_system=macos&libc_type=libc&libc_type=c_std_lib&libc_type=glibc&libc_type=musl&with_javafx_if_available=true&architecture=x86&architecture=x64&architecture=aarch64';
      
      let   url       = baseUrl + '/disco/v2.0/packages' + params;
      let   json      = await getPkgs(url);
      const response  = JSON.parse(json);
      const data      = response.result;
      let   pkgsFound = []
      for (let i = 0 ; i < data.length ; i++) {
        pkgsFound.push(data[i]);
      }
      return pkgsFound;
    }
    
    async function getPkgs(url) {
      let response = await makeRequest("GET", url);
      return response;
    }
    
    async function getDownloadLink(id, directly_downloadable) {
      // Get current ephemeralId
      const packagesUrl = baseUrl + '/disco/v2.0/packages/' + id;
      const packageJson  = await makeRequest("GET", packagesUrl);
      let   responseData = JSON.parse(packageJson);
      const pkg          = responseData.result[0];
      const ephemeralId  = pkg.ephemeral_id;

      // Get download link using the current ephemeralId
      const ephemeralIdsUrl = baseUrl + '/disco/v2.0/ephemeral_ids/' + ephemeralId;
      const packageInfoJson = await makeRequest("GET", ephemeralIdsUrl);
      responseData = JSON.parse(packageInfoJson);
      const packageInfo = responseData.result[0];
      return directly_downloadable ? packageInfo.direct_download_uri : packageInfo.download_site_uri;
    }
    
    function makeRequest(method, url) {
      return new Promise(function (resolve, reject) {
        let request = new XMLHttpRequest();
        request.open(method, url);
        request.setRequestHeader('Disco-User-Info', 'Adoptium Marketplace');
        request.onload = function () {
          if (this.status >= 200 && this.status < 300) {
            resolve(request.response);
          } else {
            reject({
              status    : this.status,
              statusText: request.statusText
            });
          }
        };
        request.onerror = function () {
          reject({
            status    : this.status,
            statusText: request.statusText
          });
        };
        request.send();
      });
    }
  </script>
</body>
</html>
